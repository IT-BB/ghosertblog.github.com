---
layout: post
title: "Ubuntu桌面生存指南 (3) --- 构建Ubuntu系统基础设施"
date: 2012-10-30 13:03
comments: true
categories: [Ubuntu， Linux， Tools]
---


Ubuntu系统的基础设施
--------------------------
任何一个高可用的操作系统，必须解决以下几个重要的问题：

1. 系统易于安装升级
2. 软件丰富，完备
3. 便捷的系统备份与恢复
4. 硬件驱动完善
5. 突破墙的封锁（中国特色问题）

这一节中，我们将讨论从头开始搭建一个基础设施完善的 Ubuntu 系统。主要包括基于 Ubuntu 系统的安装，分区方案，显卡驱动安装，翻墙相关的一些技巧和同步软件（Dropbox）等基础性软件的安装方法。另外也会讨论关于系统升级的一些策略。在夯实了这些基础之后，我们也为未来的系统备份，恢复做好了准备，提高了系统的图形处理性能，解决了在不同机器，不同系统间的文件同步问题，同时突破墙的封锁，进一步方便我们日常的工作学习，极大提升系统的可用性和灾难恢复能力。

<!--more-->

从U盘安装
--------------------------

[上一篇][1] 博客中我们提到过， Ubuntu 的发行安装方式众多，我们仍然推荐从硬盘开始安装，比起光盘，相信很多同学也了解U盘的优势：易于携带，保存，复制。这里不再敷陈，我们就从制作启动U盘说起。

**1. 下载 Ubuntu ISO 文件**

访问 Ubuntu 的 [官方下载][2] 页面，选择相应版本。一般而言它的版本有桌面版，服务器版，32位，64位，LTS，非LTS之分。所谓 LTS（Long Term Support）指的是长时间支持版本，并不是每一个新版本的 Ubuntu 都是 LTS 版本，譬如，最新的 12.10 版本就不是 LTS 版本，12.04 就是 LTS 版本，12.04 之前的 LTS 版本要追溯到2010年4月发布的 10.04，同时主版本号代表发布的年份，次版本号代表发布的月份，例如：12.04表示2012年4月发布。一般来说，推荐下载最近的 LTS 版本会得到更好的官方支援。这里我们推荐安装 12.04 的64位桌面版（命名方式：ubuntu-12.04.1-desktop-amd64.iso），官方支持长达5年之久，基本上已经超过了用户当前硬件的预期使用寿命，也就是说你在换下一台PC之前无需更换操作系统。如果官方站点的下载速度较慢，你也可以搜索国内的一些镜像网站加速下载过程。譬如 [网易镜像][3]

**2. 从 Windows 制作启动U盘**

在 Windows 下访问 [Universal USB Installer][4] 的主页，这个Ubuntu官方推荐的绿色小工具就是帮助用户在手头没有 Ubuntu 的情况下，使用 Windows 来制作启动U盘。这个页面不仅包括了工具的下载链接，同时也包含了详细的操作步骤，同学们准备好1G容量以上的U盘和刚才下载到的ISO文件，按部就班操作即可。制作U盘的时候注意相应的选项，按我个人的经验它制作出的启动U盘质量相当高，甚至超越了Ubuntu下自带的工具。

![Universal-USB-Installer]

**3. 从 Ubuntu 制作启动U盘**

如果你手头有一台安装完毕的 Ubuntu 系统，你也可以通过启动 Startup Disk Creator 这个系统自带的工具制作启动U盘。注意如果你是跨版本的制作相应的启动盘可能会存在问题，笔者曾经在Ubuntu 10.04下使用这个工具制作基于12.04 ISO的启动盘，结果无法启动电脑，花了一个晚上才搞清楚原来是跨版本引发的问题，最后切换到 Windows 下的 [Universal USB Installer][4] 才解决问题。

![startup-disk-creator]

**4. Ubuntu 分区推荐方案**

在安装之前，我们先分析一下 Ubuntu 桌面系统的分区方案。

要了解分区方案，先从 Linux 系统的目录结构说起。使用 Windows 系统的用户都知道，Windows 系统先有分区的存在，然后在不同的分区下创建文件目录结构。于是我们看到诸如 C:\Windows D:\Downloads 之类目录，也就是说每一个目录首先是存在于某个分区的。Linux 系统则相反，它首先确定有目录的存在，例如：/， /usr， /media/usb，/media/cdrom， /disk 然后才确定这个目录上挂载的是哪个分区（甚至挂载的可能是CDROM， USB等外设）。访问某个目录，实质上就相当于访问挂载在这个目录上的分区或者外设。我们在 [上一篇][1] 博客中提到过一个系统存储重要数据的目录 **/home** 目录， 在通常的最佳实践中，可以把这个 home 目录作为一个单独的挂载点，挂载一个独立分区。这样做有几个好处：

1. 系统分区如果损坏，幷不影响到 /home 分区所在的数据。这些数据通常非常重要，包括有你常用的软件，重要的文档以及各类软件的配置信息，反过来我们也鼓励把重要的数据存放在 /home 目录下，使得他们保存在系统分区以外的分区，避免因为系统的问题受损。
2. 在重装系统，或者升级系统以后，/home 分区的数据可以得到保留，最大程度的避免了软件安装和重新配置的耗时工作。
3. 在日常备份的工作中可以选择只备份 /home 分区所在的数据，避免做全盘的备份。

我自己就曾经因为在两年前安装Ubuntu 10.04的时候只分了一个分区，把 /home 目录下的数据和系统文件存储在了同一个分区下，导致在安装Ubuntu 12.04的时候，在没有第二个分区和第二台电脑用来备份/home目录数据的情况下，忍痛将整个系统连同/home目录里的数据全部格式化，损失惨重，教训深刻。

所以一般来说一个 Ubuntu 的系统在安装之初应该有三个分区，他们分别是挂载于根目录 /, home目录 /home 的分区以及 swap 分区。swap分区是指虚拟内存的交换区，一般设置为实际内存容量的两倍大小即可。

假设你有一台500G硬盘，2G内存的PC，那么比较好的分区分配方案是：根目录所在分区分配50G左右， swap分区分配4G，剩余空间全部留给 /home 所在分区即可。

**5. 安装注意事项**

在安装之前，记得备份本机重要数据。在电脑上插入启动U盘后，选择从U盘启动计算机，大多数电脑可以通过在出现启动画面的时候按F12选择启动媒介，此时选择U盘即可。之后一路安装 Ubuntu 会比较顺利，但是以下几个地方仍然需要注意：

1. 在 Installation type 界面选择 Something else 选项，这样你才有机会调整，保留现有分区以及分区上的数据，并将多个分区挂载到同一个系统的不同挂载点（上文所述的根目录和home目录）【推荐】。
2. 选择 ext4 文件系统格式作为 Linux 的文件系统格式。
3. 三个分区大小可按上个小节分配，根目录分区大小不必过大，50G至多，如果硬盘本身不大，只分配10G问题也不大。大多的数据应该存放在 /home， 因此 /home 所在分区应该足够大。
4. Installation type 界面中 Device for boot loader installation 选项列表中记得选择硬盘所在条目一般是：/dev/sda，笔者安装 12.04 时因为不慎选择了 USB 所在媒介：/dev/sdb 导致安装完毕后只有插着USB才能启动系统，悲剧！

大致的效果图如下（忽略分区尺寸一项，随意填的）

![installation-type]

[1]: /blog/2012/10/22/ubuntu-living-handbook-experience/
[2]: http://www.ubuntu.com/download
[3]: http://mirrors.163.com/ubuntu-releases/precise/
[4]: http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/
[Universal-USB-Installer]: /images/ubuntu_living_handbook/Universal-USB-Installer.png
[startup-disk-creator]: /images/ubuntu_living_handbook/startup-disk-creator.png
[installation-type]: /images/ubuntu_living_handbook/installation-type.png

