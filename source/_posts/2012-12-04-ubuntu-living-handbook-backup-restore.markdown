---
layout: post
title: "Ubuntu桌面生存指南 (4) --- Ubuntu系统备份恢复升级策略"
date: 2012-12-04 20:10
comments: true
categories: [Ubuntu， Linux， Tools]
---


Ubuntu系统备份恢复升级策略
--------------------------
继续上篇的内容，在最初使用开发者系统的时候，无论是[构建Ubuntu系统基础设施][1]，还是安装配置各种软件都是一个费心劳力的过程：由于开发者系统是一个需要付出脑力成本换取高效率的系统，它因此被设计成一个高可定制又极度自由的系统，暂且不说你可以自由地从编译源码的方式配置安装整个操作系统，即便是大多数的常用软件例如：vi，emacs等等通过变更配置文件都可以玩出无数的操作方式，用户需要花费时间去变更尝试这些配置，使得操作这些软件的方式最符合自己的习惯，达到高效的目的。因此经过一段时间调配，每一个Linux用户都会有一个自己专属的高效系统，有1000个用户就会有1000个专属高效系统，每一个系统上安装的软件和配置方法都各不一样，并且每一个用户在打造这个专属系统的过程中都会耗费大量的精力和时间。丢失自己的专属系统，就意味着时间精力的丢失，对于一个长期使用Linux的用户更是如此：用户已经在这个系统上积累太多软件和操作习惯，如果因为系统崩溃而需要从头开始配置一个全新的系统，在事前又没有任何备份措施，那剩下的简直就是一场灾难。这也是有经验的Linux用户很注意备份的原因。介于此，笔者在本章节结合自己的一些经验来介绍一下Ubuntu系统的备份恢复以及升级策略:

1. 脚本恢复策略
2. tar包整体备份恢复策略
3. 迁徙wubi系统到物理分区
4. 谈谈 GitHub 作为备份的意义
4. Ubuntu系统升级的频率，时机及注意事项

<!--more-->

脚本恢复策略 --- 完全格式化更新
--------------------------
我们前面介绍过Ubuntu系统的一个特色就是可以从自己的源通过**apt-get**命令来下载需要的软件，因此用户可以建立一个脚本文件，通过写入常用的**apt-get install**命令的方式来备份需要的软件(参见[上一篇][1]中的**在云端保存一个软件安装的脚本**部分)，同时在这个脚本文件中加入某些需要手工干预的个性化配置的具体步骤，例如：更改激活拼音输入法快捷键的具体步骤(大多数拼音输入法抢占了ctrl+space，如果不更改，开发者用户就无法在诸如Eclipse这样的IDE里使用这个快捷键激活智能代码提示的功能)，又例如：你可能对 Firefox 的默认字体并不满意，需要替换一下，这些详细的步骤都应该作为注释的形式记录在这个脚本里，如果这些步骤实在太过繁琐，也可以在配置以后，找到对应的配置文件，直接保存在Dropbox里，方便今后直接从云端恢复这些配置到本机。例如，你自己定制化了Vim的行为并且加装了Vim插件，那你只需要将~/.vimrc ~/.vim备份在云端即可。

所以一旦建立了这样一个脚本文件，即使需要重装系统或者面对一台全新的计算机，只需要执行这个脚本文件，查看脚本里的注释记录，就可以保证软件没有丢失，配置软件的步骤可以还原，重要的资料都被存储在云端：Dropbox（二进制文件），GitHub（文本文件，以下详述）。自然这个策略的前提是你在使用系统的时候必须保持勤于更新脚本的习惯，用于日后的系统恢复。

1. 优点
这种方法比较适用于希望将现有系统迁徙到更高版本的情形。例如：迁徙 Ubuntu 10.04 至 12.04的时候，在格式化系统，重新安装12.04以后，用户就可以通过这个脚本恢复原先计算机的面貌。并且由于Ubuntu源里的软件版本和Ubuntu发行版版本之间存在对应关系(例如：10.04源里的firefox版本可能在某个版本以后不再提供更新)，如果12.04在目前还是一个比较新的LTS版本，那么就可以保证在12.04上使用**apt-get install**安装的软件版本都比较新。同时如果你大多数的配置恢复是通过还原具体步骤完成的，那么就有机会检查这些步骤在新版本软件上是否仍旧适用。也不会出现从云端恢复旧版本软件的配置到新版本软件以后无法适用的状况，当然理论上这也不是一个太大的问题，Linux下许多著名的软件都非常尊重用户的旧有习惯，轻易不会变更自己读取配置文件的方式，大多数情况下恢复旧有软件的配置到新版本不会出现太多状况。

2. 缺点
由于没有采用全盘备份的方式，这种备份恢复策略的缺点同样明显，尽管可以保证在升级以后，计算机的原始面貌不会有任何丢失，但是相对来说，手动恢复许多软件的配置仍旧需要投入相当的时间和精力，即使在备份策略完善的前提下，笔者通过这种方式将Ubuntu 10.04升级到12.04的时候仍然花费了整整5天的国庆长假。因此个人建议只在每隔两年发布一次的LTS版本出现的时候才做这样的升级，以此保证计算机的全新状态。


脚本恢复策略 --- 沿用/home分区数据
--------------------------
我们前面提到过独立/home分区的意义在于用户大多数重要的个性化配置和数据都保存在这个目录，以至于Ubuntu官方的云端备份软件Ubuntu One在默认情况下就是协助用户备份/home分区所在的数据到云端。因此如果可以在重装系统的时候沿用这个分区的数据，无疑可以为我们节省大量的数据恢复和配置恢复的时间，更何况某些数据如电影，照片可能占据几百个G的空间，没有独立/home分区，用户在重装系统需要格式化分区的时候根本就没有可以备份容纳那么大数据的第二个媒介，除非你有第二块硬盘。在恢复系统的时候因为配置和数据仍旧在/home目录，你只需要执行前面提到的脚本重新安装软件即可。

为了使用这种恢复策略，在首次安装Ubuntu的时候可以参考[上一篇][1]博客的分区推荐方案来独立出/home分区，在使用系统的过程中时刻保证只在这个目录下存储自己重要的数据和配置，如果一定有一些特例状况也一定要在恢复脚本中加以记录，在云端有另外的备份措施。只要你的/home分区没有被损坏，再次恢复的代价就相当的小。重装系统的时候可以格式化 / 目录所挂载的分区，但是记得在以下Installation type界面上千万不要选择格式化 /home 所在的分区，否则就无法沿用这个分区的数据。

![installation-type]

1. 优点
显而易见，这种策略很经济，省去很多的麻烦，是非常常见的系统恢复策略，同样也适用于在重新安装一个高版本发行版(从10.04LTS升级至12.04LTS)以后恢复计算机原先的面貌。

2. 缺点
沿用过去/home分区的数据毕竟在保留了数据的同时也保留了旧有的配置和目录结构，如前所述虽然在匹配新版本软件的时候，这不会是一个太大的问题，但是一旦出现状况，例如两个软件版本之间的差异过大，导致新版本无法正常工作在旧配置或者目录结构上，用户要有一定解决问题的能力，仍然需要通过查看脚本注释手动还原配置步骤。而且对于某些有心理洁癖的同学也会感觉这种方式不那么“干净”。


tar包整体备份恢复策略
--------------------------
上述两种恢复策略免不了还是需要在分区以后，插入启动U盘或者光盘，从头开始安装操作系统本身，并且安装完操作系统以后继续安装软件，恢复配置，熟悉Windows下大名鼎鼎的Ghost的同学一定在想，Ubuntu下是否也有这种一站式的全盘备份方案：无论计算机系统当前的状态，我可以对整个系统的每一个字节都做数据备份，当需要恢复系统的时候甚至都不必再次安装Ubuntu本身就可以把当初备份的那个状态复原到新的机器或者格式化以后的当前机器上，甚至是虚拟机上。这也是一般公司的IT部门在帮员工重装机器的时候最常用的策略，没有其它原因，就是因为这种方式最快捷。备份恢复一个系统的时间不会超过一个小时。

1. 优点
最迅速快捷的备份恢复方式，可以通过刻录母盘的方式在各处恢复自己的备份。你既可以在一台物理机上做备份恢复到另一台物理机或者虚拟机，你甚至也可以将一台虚拟机里的备份恢复到一台物理机或者另一台虚拟机上，非常的灵活方便。

2. 缺点
采用这种方式的一个问题在于，如果需要还原的目标机器和做备份的源机器硬件配置差异过大，可能会发生恢复以后某些驱动程序工作不正常的状况，例如计算机没办法发声音，或者图形分辨率特别低，无法联网等状况。这个时候仍然需要用户自己尝试解决。第二个问题在于由于全盘备份，意味着如果你备份的是10.04的系统，那你也只能恢复到10.04的系统，这种恢复方式没有办法升级你的Ubuntu到更高的版本。第三个问题：一定的学习实践成本，以下就我个人的实践经验提供tar包全盘备份的基本步骤和原理，也许你在网络上可以找到更方便的脚本或者备份软件替代这些工作，但是如果遇到问题回到这些具体的步骤和原理可以帮助你了解到底是哪里出了问题，咋么解决这些问题。







**未完待续......**


[1]: /blog/2012/10/30/ubuntu-living-handbook-install/
[installation-type]: /images/ubuntu_living_handbook/installation-type.png
